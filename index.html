<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Simple Sheet</title>
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#e0e0e0">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon-96x96.png">
    <style>
        /* --- Âü∫Êú¨„Çπ„Çø„Ç§„É´ --- */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 8px; background-color: #f0f2f5; margin: 0; box-sizing: border-box; font-size: 16px; color: #000; }
        * { box-sizing: border-box; }
        .app-grid { display: flex; gap: 12px; max-width: 1600px; margin: 0 auto; align-items: flex-start; }
        
        /* „É°„É¢Â∏≥„Ç®„É™„Ç¢ (FreeÁâà: ËÉåÊôØËâ≤„ÇíËñÑ„ÅÑÈªÑËâ≤„Å´Â§âÊõ¥) */
        .memo-container { flex: 1; min-width: 250px; background-color: #fff; padding: 12px; border-radius: 10px; box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1); height: 85vh; position: sticky; top: 8px; display: flex; flex-direction: column; }
        .memo-area { flex: 1; width: 100%; resize: none; border: 1px solid #ccc; border-radius: 8px; padding: 10px; font-size: 0.95em; line-height: 1.5; outline: none; background: #FFF2CC; color: #555; margin-bottom: 10px; cursor: not-allowed; }
        .memo-links { max-height: 150px; overflow-y: auto; padding: 5px; background: #f9f9f9; border-radius: 6px; border: 1px dashed #ccc; }
        .memo-link-item { display: block; padding: 6px; margin-bottom: 4px; background: #e3f2fd; color: #0d47a1; text-decoration: none; border-radius: 4px; font-size: 0.9em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .memo-link-item:hover { background: #bbdefb; }

        /* Ë®àÁÆó„Ç∑„Éº„Éà */
        .sheet-container { flex: 2; min-width: 0; background-color: #fff; padding: 12px; border-radius: 10px; box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1); }
        
        /* ÈõªÂçì */
        .side-calc { flex: 1; min-width: 260px; background: #333; padding: 12px; border-radius: 10px; color: white; height: fit-content; position: sticky; top: 8px; }

        .row { display: flex; margin-bottom: 12px; padding: 12px; border: 1px solid #ccc; border-radius: 10px; background-color: #fff; gap: 8px; }
        @media screen and (min-width: 1001px) {
            .row { flex-direction: row; align-items: center; justify-content: space-between; }
            .text-label-input { flex: 1.5; }
            .calc-area { flex: 1; justify-content: center; }
            .result-area { flex: 2; justify-content: flex-end; background: #f8f9fa; padding: 5px 10px; border-radius: 6px; }
            .result-text { font-size: 1.6em; }
        }
        @media screen and (max-width: 1000px) {
            body { padding-top: calc(env(safe-area-inset-top) + 10px) !important; padding-left: 8px; padding-right: 8px; }
            .app-grid { flex-direction: column; }
            .memo-container { width: 100%; height: auto; min-height: 200px; position: static; margin-bottom: 12px; }
            .sheet-container { width: 100%; }
            .top-controls { flex-wrap: wrap; }
            .row { flex-direction: column !important; align-items: stretch !important; }
            .text-label-input { width: 100% !important; font-size: 1.1em; padding: 10px; margin-bottom: 5px; }
            .calc-area { width: 100% !important; justify-content: center !important; padding: 10px 0; border-top: 1px dashed #eee; border-bottom: 1px dashed #eee; }
            .result-area { width: 100% !important; justify-content: space-between !important; background: #eefbff; padding: 12px; border-radius: 8px; }
            .result-text { font-size: 2.2em; word-break: break-all; }
            .side-calc { display: none; position: fixed; bottom: 80px; right: 15px; z-index: 1000; width: 280px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
            .side-calc.active { display: block; }
            .calc-toggle-btn { display: block; }
            .mobile-calc-close { display: block; }
        }
        /* „Éë„Éº„ÉÑÈ°û */
        .text-label-input { padding: 8px; border: 2px solid #000; border-radius: 6px; font-weight: bold; color: #000; outline: none; }
        .calc-area { display: flex; align-items: center; gap: 8px; }
        .multiplier-input { width: 110px; font-size: 1.5em; padding: 8px; text-align: right; border: 3px solid #007bff; border-radius: 6px; font-weight: bold; color: #000; outline: none; }
        .result-text { font-weight: bold; color: #007bff; }
        .operator-group { display: flex; flex-direction: column; align-items: center; width: 32px; }
        .operator-control { font-size: 0.7em; background: #333; color: #fff; width: 100%; height: 20px; display: flex; justify-content: center; align-items: center; border-radius: 3px; cursor: pointer; }
        .operator-display { font-size: 1.6em; font-weight: bold; text-align: center; color: #000; height: 35px; line-height: 35px; width: 100%; }
        .percent-toggle, .base-toggle { border: 2px solid #ccc; border-radius: 6px; width: 50px; height: 50px; display: flex; justify-content: center; align-items: center; cursor: pointer; font-weight: bold; background: #fff; font-size: 1.3em; flex-shrink: 0; color: #000; user-select: none; }
        .percent-toggle.active { background: #dc3545; color: #fff; border-color: #dc3545; }
        .base-toggle.chain { background: #007bff; color: #fff; border-color: #007bff; }
        .action-btn { border: none; background: none; cursor: pointer; font-size: 1.8em; opacity: 0.7; padding: 5px; }
        .master-row { padding: 12px; margin-bottom: 12px; border: 3px solid #dc3545; border-radius: 10px; background-color: #fff; display: flex; align-items: center; justify-content: space-between; }
        .master-input { width: 45%; padding: 8px; border: 2px solid #dc3545; border-radius: 6px; font-size: 1.5em; text-align: right; font-weight: bold; color: #000; outline: none; }
        .storage-bar { background: #e9ecef; border: 2px solid #adb5bd; border-radius: 10px; padding: 10px; margin-bottom: 12px; display: flex; flex-direction: column; gap: 8px; }
        .storage-controls { display: flex; align-items: center; gap: 10px; }
        .save-btn-main { background: #6c757d; color: white; border: none; padding: 8px 15px; border-radius: 6px; font-weight: bold; cursor: pointer; white-space: nowrap; opacity: 0.9; }
        .edit-toggle-btn { background: #6c757d; color: white; border: none; padding: 8px 12px; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 1.2em; min-width: 50px; opacity: 0.9; }
        
        .utility-bar { display: flex; justify-content: center; gap: 6px; margin-bottom: 12px; flex-wrap: wrap; }
        .util-btn { border: none; background: #6c757d; color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85em; font-weight: bold; min-width: 60px; }
        .util-btn.manual { background: #17a2b8; width: auto; }
        .util-btn.reset { background: #dc3545; }

        .calc-display-wrap { position: relative; margin-bottom: 10px; }
        .calc-display { width: 100%; height: 52px; background: #222; color: #fff; text-align: right; font-size: 1.8em; padding: 8px 45px 8px 8px; border-radius: 6px; border: none; outline: none; }
        .calc-copy-btn-in { position: absolute; right: 5px; top: 5px; bottom: 5px; width: 40px; background: #007bff; border: none; border-radius: 4px; font-size: 1.2em; cursor: pointer; display: flex; align-items: center; justify-content: center; opacity: 0.9; color: white; }
        .calc-buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
        .calc-btn { padding: 15px 5px; border: none; border-radius: 6px; cursor: pointer; font-size: 1.25em; font-weight: bold; background: #555; color: white; }
        .calc-btn.op { background: #f39c12; }
        .calc-btn.equal { background: #27ae60; grid-column: span 2; }
        .calc-btn.clear { background: #c0392b; }
        #saveMessage { position: fixed; top: 15px; left: 50%; transform: translateX(-50%); background: #000; color: #fff; padding: 12px 25px; border-radius: 25px; opacity: 0; transition: opacity 0.3s; z-index: 2000; pointer-events: none; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .calc-toggle-btn { display: none; position: fixed; bottom: 15px; right: 15px; width: 60px; height: 60px; border-radius: 50%; background: #333; color: white; border: none; font-size: 28px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1001; cursor: pointer; }
        .mobile-calc-close { display: none; background: none; border: none; color: white; font-size: 1.5em; cursor: pointer; }
        .pro-modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 3000; justify-content: center; align-items: center; padding: 20px; }
        .pro-modal-overlay.active { display: flex; }
        .pro-modal-content { background: #fff; padding: 25px; border-radius: 15px; text-align: center; max-width: 450px; width: 100%; box-shadow: 0 5px 20px rgba(0,0,0,0.3); animation: popIn 0.3s ease; }
        .pro-title { font-size: 1.4em; font-weight: bold; margin-bottom: 10px; color: #333; }
        .pro-desc { color: #666; margin-bottom: 20px; line-height: 1.6; text-align: left; white-space: pre-wrap; font-size: 0.95em; }
        .pro-btn-buy { display: block; width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; font-weight: bold; text-decoration: none; border-radius: 25px; margin-bottom: 10px; border: none; cursor: pointer; font-size: 1.1em; }
        .pro-btn-close { background: none; border: none; color: #999; cursor: pointer; text-decoration: underline; font-size: 0.9em; }
        .text-area-import { width: 100%; height: 120px; padding: 10px; margin-bottom: 15px; background: #f9f9f9; border: 1px solid #ccc; border-radius: 8px; font-size: 0.9em; color: #333; resize: none; }
        .title-pro-btn { display: inline-flex; align-items: center; justify-content: center; gap: 6px; background: linear-gradient(135deg, #1a237e 0%, #000 100%); color: white; text-decoration: none; padding: 8px 20px; border-radius: 20px; font-weight: bold; font-size: 0.9em; box-shadow: 0 3px 6px rgba(0,0,0,0.15); margin: 0 auto 15px auto; transition: transform 0.2s; border:none; cursor:pointer; }
    </style>
</head>
<body onload="init()">

    <div id="saveMessage"></div>

    <div id="proModal" class="pro-modal-overlay">
        <div class="pro-modal-content" style="max-width:350px;">
            <div class="pro-icon">üíé</div>
            <div id="modalTitle" class="pro-title">Pro Feature</div>
            <div id="modalDesc" class="pro-desc" style="text-align:center;"></div>
            <button class="pro-btn-buy" id="modalBtn" onclick="alert('Coming soon with IAP!')">Upgrade to Pro</button>
            <button class="pro-btn-close" id="btnClosePro" onclick="closeProModal()">Close</button>
        </div>
    </div>

    <div id="pcModal" class="pro-modal-overlay">
        <div class="pro-modal-content" style="max-width:350px;">
            <div class="pro-icon">üíª</div>
            <div id="pcModalTitle" class="pro-title">PC / Web Version</div>
            <div id="pcModalDesc" class="pro-desc" style="margin-bottom: 10px; text-align:center;"></div>
            <input type="text" class="url-box" id="pcUrlInput" value="https://thejetdev.github.io/Simple-Sheet-Pro/" readonly>
            <button class="pro-btn-buy" id="btnCopyUrl" onclick="copyPcUrl()" style="background: linear-gradient(135deg, #1a237e, #283593);">Copy URL</button>
            <button class="pro-btn-close" id="btnClosePc" onclick="closePcModal()">Close</button>
        </div>
    </div>
    
    <div id="manualModal" class="pro-modal-overlay">
        <div class="pro-modal-content">
            <div id="manTitle" class="pro-title" style="text-align:center; border-bottom:1px solid #eee; padding-bottom:10px;">Manual</div>
            <div id="manBody" class="pro-desc" style="margin-top:15px; max-height: 400px; overflow-y: auto;"></div>
            <button class="pro-btn-close" onclick="closeModal('manualModal')" id="manClose" style="width:100%; text-decoration:none; background:#eee; padding:10px; border-radius:20px; font-weight:bold; color:#555;">OK</button>
        </div>
    </div>

    <div id="importModal" class="pro-modal-overlay">
        <div class="pro-modal-content" style="max-width:350px;">
            <div class="pro-title" id="impTitle">Import Data</div>
            <div class="pro-desc" id="impDesc" style="text-align:center; margin-bottom:10px;">Paste data here:</div>
            <textarea id="importText" class="text-area-import" placeholder='Paste code here...'></textarea>
            <button class="pro-btn-buy" id="btnDoImport" onclick="executeImport()" style="background: #007bff;">Load Data</button>
            <button class="pro-btn-close" id="btnCloseImp" onclick="closeModal('importModal')">Close</button>
        </div>
    </div>
    
    <button class="calc-toggle-btn" onclick="toggleCalc()">üßÆ</button>

    <div class="app-grid">
        
        <div class="memo-container">
            <h3 id="memoTitle" style="margin: 0 0 10px 0; font-size: 1.1em; text-align: center; color: #555;">üìù Memo</h3>
            <textarea id="memoArea" class="memo-area" placeholder="Viewing mode (Edit is Pro feature)" onclick="triggerProPromo()" readonly></textarea>
            <div id="memoLinks" class="memo-links"></div>
        </div>

        <div class="sheet-container">
            
            <div class="top-controls" style="display:flex; justify-content: space-between; align-items: center; margin-bottom:10px; flex-wrap: wrap; gap:8px;">
                <div style="flex:1; display:flex; align-items:center; border:2px solid #000; border-radius:6px; padding:6px 10px; min-width:140px; background:#fff;">
                    <span id="labelNameSpan" style="font-size:0.8em; color:#000; font-weight:bold; margin-right:8px;">Name:</span>
                    <input type="text" id="masterLabel" style="border:none; outline:none; font-weight:bold; width:100%; color:#000;" oninput="saveSettings()">
                </div>
                <div style="display:flex; gap:5px; align-items:center;">
                    <div id="langContainer" style="display:flex; gap:3px; flex-wrap: wrap;"></div>
                </div>
            </div>

            <div class="storage-bar">
                <div class="storage-controls">
                    <button class="save-btn-main" onclick="triggerProPromo()">üíæ <span id="btnSaveMemory">Save</span></button>
                    <button id="editToggle" class="edit-toggle-btn" onclick="triggerProPromo()">üóëÔ∏è</button>
                </div>
                <div id="saveList" class="save-list-container"></div>
            </div>

            <h2 id="title" style="font-weight: bold; margin-bottom: 15px; text-align:center;">Simple Sheet</h2>

            <div style="text-align: center;">
                <button class="title-pro-btn" id="btnLinkPro" onclick="triggerProPromo()">üöÄ Go to Pro Version</button>
            </div>

            <div class="utility-bar">
                <button class="util-btn manual" style="width: auto; background:#17a2b8;" onclick="openManual()" id="btnManual">üìñ Manual</button>
                <button class="util-btn" onclick="clearNumbers()">üßπ <span id="btnClear">Clear</span></button>
                <button class="util-btn" onclick="exportData()">üì§ <span id="btnExport">Exp</span></button>
                <button class="util-btn" onclick="openImport()">üì• <span id="btnImport">Imp</span></button>
                <button class="util-btn reset" onclick="fullReset()">üîÑ <span id="btnReset">Reset</span></button>
            </div>

            <div id="main-sheet-mode">
                <div class="master-row">
                    <label id="masterLabelStart" style="font-weight:bold; color:#dc3545;">Base Value</label>
                    <input type="number" id="masterInput" class="master-input" step="any" placeholder="" oninput="updateDisplay()">
                </div>
                <div id="rows-container"></div>
                <div style="text-align: center; margin-top: 15px; display: flex; gap: 8px;">
                    <button class="mode-button" id="addBtn" style="background:#28a745; color:white; flex-direction:row; min-height:auto; width:100%; justify-content:center; border:none; border-radius:6px; padding:12px; font-weight:bold; font-size:1.1rem; cursor:pointer;" onclick="addRow()">+ Row</button>
                    <button class="mode-button" id="copyBtn" style="background:#007bff; color:white; flex-direction:row; min-height:auto; width:100%; justify-content:center; border:none; border-radius:6px; padding:12px; font-weight:bold; font-size:1.1rem; cursor:pointer;" onclick="copyPage()">All Copy</button>
                </div>
            </div>

        </div>

        <div id="sideCalc" class="side-calc">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3 id="ui-calcTitle" style="margin:0;">Calculator</h3>
                <button class="mobile-calc-close" onclick="toggleCalc()">√ó</button>
            </div>
            <div class="calc-display-wrap">
                <input type="text" id="calcDisplay" class="calc-display" readonly value="0">
                <button class="calc-copy-btn-in" onclick="copyCalcResult()">üìã</button>
            </div>
            <div class="calc-buttons">
                <button class="calc-btn clear" onclick="calcInput('AC')">AC</button>
                <button class="calc-btn op" onclick="calcInput('%')">%</button>
                <button class="calc-btn op" onclick="calcInput('/')">√∑</button>
                <button class="calc-btn op" onclick="calcInput('*')">√ó</button>
                <button class="calc-btn" onclick="calcInput('7')">7</button>
                <button class="calc-btn" onclick="calcInput('8')">8</button>
                <button class="calc-btn" onclick="calcInput('9')">9</button>
                <button class="calc-btn op" onclick="calcInput('-')">-</button>
                <button class="calc-btn" onclick="calcInput('4')">4</button>
                <button class="calc-btn" onclick="calcInput('5')">5</button>
                <button class="calc-btn" onclick="calcInput('6')">6</button>
                <button class="calc-btn op" onclick="calcInput('+')">+</button>
                <button class="calc-btn" onclick="calcInput('1')">1</button>
                <button class="calc-btn" onclick="calcInput('2')">2</button>
                <button class="calc-btn" onclick="calcInput('3')">3</button>
                <button class="calc-btn" onclick="calcInput('.')">.</button>
                <button class="calc-btn" onclick="calcInput('0')">0</button>
                <button class="calc-btn clear" style="background:#e67e22;" onclick="calcInput('BS')">‚å´</button>
                <button class="calc-btn equal" onclick="calcResult()">=</button>
            </div>
        </div>
    </div>

    <script>
        const fullManual = {
            ja: "Simple Sheet „Å´„Å§„ÅÑ„Å¶\n\nÈõªÂçì„Çà„ÇäÊï¥ÁêÜ„Åß„Åç„Å¶„ÄÅ\n„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åª„Å©Ë§áÈõë„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ\n\nSimple Sheet „ÅØ„ÄÅ\nË®àÁÆó„ÇíÊï¥ÁêÜ„Åó„Å¶ÊÆã„Åô„Åü„ÇÅ„ÅÆ„Ç¢„Éó„É™„Åß„Åô„ÄÇ\n\nË∂≥„Åô„ÄÅÂºï„Åè„ÄÅÊéõ„Åë„Çã„ÄÅÂâ≤„Çã„ÄÅ\n„Åì„ÅÆ4„Å§„ÅÆË®àÁÆó„ÅßÊßãÊàê„Åó„Åæ„Åô„ÄÇ\nË®àÁÆó„ÅÆÊµÅ„Çå„ÅØ„Åù„ÅÆ„Åæ„ÅæÊÆã„Çä„Åæ„Åô„ÄÇ\n\n„ÄêË®àÁÆó„É¢„Éº„Éâ„ÅÆÂàáÊõø„Äë\nüè† ÂÖÉ„ÅÆÊï∞Â≠ó: ‰∏ÄÁï™‰∏ä„ÅÆ„ÄåÂÖÉ„ÅÆÊï∞Â≠ó„Äç„Çí‰Ωø„ÅÑ„Åæ„Åô„ÄÇ\nüîó „ÉÅ„Çß„Éº„É≥: ‰∏Ä„Å§‰∏ä„ÅÆË°å„ÅÆË®àÁÆóÁµêÊûú„Çí‰Ωø„ÅÑ„Åæ„Åô„ÄÇ\n\n„Éú„Çø„É≥„Çí„Çø„ÉÉ„Éó„Åó„Å¶Âàá„ÇäÊõø„Åà„Åæ„Åô„ÄÇ\n\n„Äê„Ç™„Éº„É´„Ç≥„Éî„Éº (Ë°®„Å®„Åó„Å¶‰Ωø„ÅÜ)„Äë\nË®àÁÆóÁµêÊûú„ÇíË°®„Å®„Åó„Å¶„Ç≥„Éî„Éº„Åó„Åæ„Åô„ÄÇ\nExcel „ÇÑ Google „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´Ë≤º„Çä‰ªò„Åë„Å¶‰Ωø„Åà„Åæ„Åô„ÄÇ\n‚ÄªÈï∑Êñá„ÅåÈö†„Çå„Å™„ÅÑ„Çà„ÅÜ„ÄÅÈ†ÖÁõÆÂêç„Å®Êï∞Â≠ó„ÅÆÈñì„Å´Á©∫ÁôΩÂàó„ÇíÊåü„Çì„Åß„ÅÑ„Åæ„Åô„ÄÇ\n(JSON„Ç≥„Éº„Éâ„ÅØÂê´„Åæ„Çå„Åæ„Åõ„Çì)\n\n„ÄêÂá∫Âäõ („Éá„Éº„Çø„Å®„Åó„Å¶‰Ωø„ÅÜ)„Äë\nË®àÁÆó„Éá„Éº„Çø„Åù„ÅÆ„ÇÇ„ÅÆ„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åô„ÄÇ\nSimple Sheet „Å´Ë≤º„Çä‰ªò„Åë„Å¶„ÄÅÂÖ±Êúâ„ÉªÂÜçÁ∑®ÈõÜ„Åß„Åç„Åæ„Åô„ÄÇ\n\n„ÄêË™≠Ëæº(„Ç§„É≥„Éù„Éº„Éà)„Äë\n„Ç≥„Éî„Éº„Åó„Åü„ÉÜ„Ç≠„Çπ„Éà„ÇíË™≠ËæºÁîªÈù¢„Å´Ë≤º„Çä‰ªò„Åë„Åæ„Åô„ÄÇ\n\nÊå®Êã∂Êñá„Å™„Å©„ÅåÊ∑∑„Åñ„Å£„Å¶„ÅÑ„Å¶„ÇÇ„ÄÅËá™Âãï„Åß„Éá„Éº„Çø„Å†„Åë„ÇíÊäú„ÅçÂá∫„Åó„Åæ„Åô„ÄÇ\n\n„ÄêÊ©üËÉΩÂà∂Èôê„Å´„Å§„ÅÑ„Å¶„Äë\n‰øùÂ≠ò„Å®„É°„É¢Â∏≥„ÅÆÊõ∏„ÅçËæº„Åø„ÅØProÁâà„ÅÆÊ©üËÉΩ„Åß„Åô„ÄÇ",
            en: "About Simple Sheet\n\nMore organized than a calculator,\nLess complicated than a spreadsheet.\n\nSimple Sheet is an app for organizing and keeping your calculations.\n\nIt consists of 4 operations: Add, Subtract, Multiply, Divide.\nThe flow of calculation remains.\n\n„ÄêSwitching Calc Mode„Äë\nüè† Base: Uses the top 'Base Value'.\nüîó Chain: Uses the result of the row directly above.\nTap the button to switch.\n\n„ÄêCopy All (Use as Table)„Äë\nCopies the result as a table.\nYou can paste it into Excel or Google Sheets.\n*An empty column is added between Item and Number to prevent text hiding.\n(JSON code is not included)\n\n„ÄêExport (Use as Data)„Äë\nCopies the calculation data code.\nPaste into Simple Sheet to share or re-edit.\n\n„ÄêImport„Äë\nPaste the copied text into the import screen.\n\nEven if there are greetings or other text mixed in, it will automatically extract only the data.\n\n„ÄêFeature Limitations„Äë\nSaving and memo writing are Pro version features.",
            zh: "ÂÖ≥‰∫é Simple Sheet\n\nÊØîËÆ°ÁÆóÂô®Êõ¥ÊúâÊù°ÁêÜÔºå\n‰∏çÂÉèÁîµÂ≠êË°®Ê†ºÈÇ£‰πàÂ§çÊùÇ„ÄÇ\n\nSimple Sheet ÊòØ‰∏ÄÊ¨æÁî®‰∫éÊï¥ÁêÜÂíå‰øùÂ≠òËÆ°ÁÆóÁöÑÂ∫îÁî®Á®ãÂ∫è„ÄÇ\n\nÁî±Âä†„ÄÅÂáè„ÄÅ‰πò„ÄÅÈô§ÂõõÁßçËøêÁÆóÁªÑÊàê„ÄÇ‰øùÁïôËÆ°ÁÆóÊµÅÁ®ã„ÄÇ\n\n„ÄêÊ®°ÂºèÂàáÊç¢„Äë\nüè† ÂàùÂßãÂÄº: ‰ΩøÁî®È°∂ÈÉ®ÁöÑ‚ÄúÂàùÂßãÂÄº‚Äù„ÄÇ\nüîó Èìæ: ‰ΩøÁî®‰∏ä‰∏ÄË°åÁöÑÁªìÊûú„ÄÇ\n\n„ÄêÂÖ®ÈÉ®Â§çÂà∂ (‰ΩúË°®‰ΩøÁî®)„Äë\nÂ∞ÜËÆ°ÁÆóÁªìÊûú‰Ωú‰∏∫Ë°®Ê†ºÂ§çÂà∂„ÄÇ\nÂèØÁ≤òË¥¥Âà∞ Excel Êàñ Google Sheets ‰∏≠‰ΩøÁî®„ÄÇ\n*Âú®È°πÁõÆÂêçÂíåÊï∞Â≠ó‰πãÈó¥ÊèíÂÖ•Á©∫Âàó‰ª•Èò≤Ê≠¢ÊñáÂ≠óË¢´ÈÅÆÊå°„ÄÇ\n(‰∏çÂåÖÂê´ JSON ‰ª£Á†Å)\n\n„ÄêÂØºÂá∫ (‰ΩúÊï∞ÊçÆ‰ΩøÁî®)„Äë\nÂ§çÂà∂ËÆ°ÁÆóÊï∞ÊçÆÊú¨Ë∫´„ÄÇ\nÁ≤òË¥¥Âà∞ Simple Sheet ‰∏≠Âç≥ÂèØÂàÜ‰∫´ÊàñÈáçÊñ∞ÁºñËæë„ÄÇ\n\n„ÄêÂØºÂÖ•„Äë\nÂ∞ÜÂ§çÂà∂ÁöÑÊñáÊú¨Á≤òË¥¥Âà∞ÂØºÂÖ•ÁîªÈù¢„ÄÇ\n\nÂç≥‰ΩøÊ∑∑Âêà‰∫ÜÈóÆÂÄôËØ≠ÊàñÂÖ∂‰ªñÊñáÊú¨ÔºåÂÆÉ‰πü‰ºöËá™Âä®‰ªÖÊèêÂèñÊï∞ÊçÆ„ÄÇ\n\n„ÄêÂÖ≥‰∫éÂäüËÉΩÈôêÂà∂„Äë\n‰øùÂ≠òÂíåÂ§áÂøòÂΩïÁºñÂÜôÊòØ Pro ÁâàÁöÑÂäüËÉΩ„ÄÇ",
            ko: "Simple Sheet Ï†ïÎ≥¥\n\nÍ≥ÑÏÇ∞Í∏∞Î≥¥Îã§ Ï†ïÎ¶¨ÌïòÍ∏∞ ÏâΩÍ≥†,\nÏä§ÌîÑÎ†àÎìúÏãúÌä∏ÎßåÌÅº Î≥µÏû°ÌïòÏßÄ ÏïäÏäµÎãàÎã§.\n\nSimple SheetÎäî Í≥ÑÏÇ∞ÏùÑ Ï†ïÎ¶¨ÌïòÏó¨ ÎÇ®Í∏∞Í∏∞ ÏúÑÌïú Ïï±ÏûÖÎãàÎã§.\n\nÎçîÌïòÍ∏∞, ÎπºÍ∏∞, Í≥±ÌïòÍ∏∞, ÎÇòÎàÑÍ∏∞,\nÏù¥ 4Í∞ÄÏßÄ Í≥ÑÏÇ∞ÏúºÎ°ú Íµ¨ÏÑ±Îê©ÎãàÎã§.\nÍ≥ÑÏÇ∞ ÌùêÎ¶ÑÏùÄ Í∑∏ÎåÄÎ°ú ÎÇ®ÏäµÎãàÎã§.\n\n„ÄêÎ™®Îìú Ï†ÑÌôò„Äë\nüè† Í∏∞Ï§ÄÍ∞í: Îß® ÏúÑÏùò 'Í∏∞Ï§ÄÍ∞í'ÏùÑ ÏÇ¨Ïö©Ìï©ÎãàÎã§.\nüîó Ï≤¥Ïù∏: Î∞îÎ°ú Ïúó Ï§ÑÏùò Í≤∞Í≥ºÎ•º ÏÇ¨Ïö©Ìï©ÎãàÎã§.\n\n„ÄêÏ†ÑÏ≤¥ Î≥µÏÇ¨ (ÌëúÎ°ú ÏÇ¨Ïö©)„Äë\nÍ≥ÑÏÇ∞ Í≤∞Í≥ºÎ•º ÌëúÎ°ú Î≥µÏÇ¨Ìï©ÎãàÎã§.\nExcelÏù¥ÎÇò Google Ïä§ÌîÑÎ†àÎìúÏãúÌä∏Ïóê Î∂ôÏó¨ÎÑ£Ïñ¥ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n*Í∏¥ ÌÖçÏä§Ìä∏Í∞Ä Í∞ÄÎ†§ÏßÄÏßÄ ÏïäÎèÑÎ°ù Îπà Ïó¥ÏùÑ Ï∂îÍ∞ÄÌï©ÎãàÎã§.\n(JSON ÏΩîÎìúÎäî Ìè¨Ìï®ÎêòÏßÄ ÏïäÏäµÎãàÎã§)\n\n„ÄêÏ∂úÎ†• (Îç∞Ïù¥ÌÑ∞Î°ú ÏÇ¨Ïö©)„Äë\nÍ≥ÑÏÇ∞ Îç∞Ïù¥ÌÑ∞ ÏûêÏ≤¥Î•º Î≥µÏÇ¨Ìï©ÎãàÎã§.\nSimple SheetÏóê Î∂ôÏó¨ÎÑ£Ïñ¥ Í≥µÏú† Î∞è Ïû¨Ìé∏ÏßëÌï† Ïàò ÏûàÏäµÎãàÎã§.\n\n„ÄêÎ∂àÎü¨Ïò§Í∏∞(Import)„Äë\nÎ≥µÏÇ¨Ìïú ÌÖçÏä§Ìä∏Î•º Î∂àÎü¨Ïò§Í∏∞ ÌôîÎ©¥Ïóê Î∂ôÏó¨ÎÑ£ÏäµÎãàÎã§.\n\nÏù∏ÏÇ¨Îßê Îì±Ïù¥ ÏÑûÏó¨ ÏûàÏñ¥ÎèÑ ÏûêÎèôÏúºÎ°ú Îç∞Ïù¥ÌÑ∞Îßå Ï∂îÏ∂úÌï©ÎãàÎã§.\n\n„ÄêÍ∏∞Îä• Ï†úÌïúÏóê ÎåÄÌï¥„Äë\nÏ†ÄÏû• Î∞è Î©îÎ™® ÏûëÏÑ±ÏùÄ Pro Î≤ÑÏ†ÑÏùò Í∏∞Îä•ÏûÖÎãàÎã§.",
            es: "Sobre Simple Sheet\n\nM√°s organizado que una calculadora,\nMenos complicado que una hoja de c√°lculo.\n\nSimple Sheet es una aplicaci√≥n para organizar y guardar tus c√°lculos.\n\nConsiste en cuatro c√°lculos b√°sicos: Sumar, Restar, Multiplicar y Dividir.\nEl flujo del c√°lculo permanece tal cual.\n\n„ÄêCambio de modo„Äë\nüè† Valor Base: Usa el 'Valor Base' superior.\nüîó Cadena: Usa el resultado de la fila anterior.\n\n„ÄêCopiar Todo (Como tabla)„Äë\nCopia el resultado como tabla.\nPegar en Excel o Google Sheets.\n*Se inserta una columna vac√≠a para no ocultar texto largo.\n(No incluye c√≥digo JSON)\n\n„ÄêExportar (Como datos)„Äë\nCopia los propios datos del c√°lculo.\nP√©galo en Simple Sheet para compartir y re-editar.\n\n„ÄêImportar„Äë\nPegue el texto copiado en la pantalla de Importaci√≥n.\n\nIncluso si hay saludos u otro texto mezclado, extraer√° autom√°ticamente solo los datos.\n\n„ÄêLimitaciones de funciones„Äë\nGuardar y escribir notas son funciones de la versi√≥n Pro.",
            pt: "Sobre o Simple Sheet\n\nMais organizado que uma calculadora,\nMenos complicado que uma planilha.\n\nSimple Sheet √© um aplicativo para organizar e manter seus c√°lculos.\n\nConsiste em quatro c√°lculos b√°sicos: Somar, Subtrair, Multiplicar e Dividir.\nO fluxo de c√°lculo permanece como est√°.\n\n„ÄêMudan√ßa de Modo„Äë\nüè† Valor Base: Usa o valor do topo.\nüîó Cadeia: Usa o resultado da linha anterior.\n\n„ÄêCopiar Tudo (Tabela)„Äë\nCopia o resultado como tabela.\n*Insere coluna vazia para n√£o ocultar texto longo.\n(Sem c√≥digo JSON)\n\n„ÄêExportar (Dados)„Äë\nCopia os dados de c√°lculo.\nCole no Simple Sheet para compartilhar.\n\n„ÄêImportar„Äë\nCole o texto na tela de importa√ß√£o.\n\nMesmo se houver sauda√ß√µes ou outro texto misturado, ele extrair√° automaticamente apenas os dados.\n\n„ÄêLimita√ß√µes de recursos„Äë\nSalvar e escrever notas s√£o recursos da vers√£o Pro.",
            fr: "√Ä propos de Simple Sheet\n\nMieux organis√© qu'une calculatrice,\nMoins complexe qu'un tableur.\n\nSimple Sheet sert √† organiser et conserver vos calculs.\n\nElle se compose de quatre calculs de base : Additionner, Soustraire, Multiplier et Diviser.\nLe flux de calcul reste tel quel.\n\n„ÄêChangement de mode„Äë\nüè† Valeur Base : Utilise la valeur sup√©rieure.\nüîó Cha√Æne : Utilise le r√©sultat pr√©c√©dent.\n\n„ÄêTout Copier (Tableau)„Äë\nCopie le r√©sultat sous forme de tableau.\n*Une colonne vide est ajout√©e pour le texte long.\n(Code JSON non inclus)\n\n„ÄêExporter (Donn√©es)„Äë\nCopie les donn√©es de calcul.\n√Ä coller dans Simple Sheet pour partager.\n\n„ÄêImporter„Äë\nCollez le texte dans l'√©cran d'importation.\n\nM√™me s'il y a des salutations ou d'autres textes m√©lang√©s, il extraira automatiquement uniquement les donn√©es.\n\n„ÄêLimitations des fonctionnalit√©s„Äë\nL'enregistrement et la r√©daction de notes sont des fonctionnalit√©s de la version Pro.",
            ru: "–û Simple Sheet\n\n–£–¥–æ–±–Ω–µ–µ, —á–µ–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä,\n–ü—Ä–æ—â–µ, —á–µ–º —Ç–∞–±–ª–∏—Ü–∞.\n\nSimple Sheet ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤.\n\n–°–ª–æ–∂–µ–Ω–∏–µ, –≤—ã—á–∏—Ç–∞–Ω–∏–µ, —É–º–Ω–æ–∂–µ–Ω–∏–µ, –¥–µ–ª–µ–Ω–∏–µ.\n–•–æ–¥ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.\n\n„Äê–†–µ–∂–∏–º—ã„Äë\nüè† –ë–∞–∑–∞: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–µ—Ä—Ö–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.\nüîó –¶–µ–ø—å: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç—Ä–æ–∫–∏.\n\n„Äê–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ (–¢–∞–±–ª–∏—Ü–∞)„Äë\n–ö–æ–ø–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∫ —Ç–∞–±–ª–∏—Ü—É.\n*–í—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –ø—É—Å—Ç–æ–π —Å—Ç–æ–ª–±–µ—Ü –¥–ª—è –¥–ª–∏–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.\n(–ë–µ–∑ JSON –∫–æ–¥–∞)\n\n„Äê–≠–∫—Å–ø–æ—Ä—Ç (–î–∞–Ω–Ω—ã–µ)„Äë\n–ö–æ–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.\n–í—Å—Ç–∞–≤—å—Ç–µ –≤ Simple Sheet –¥–ª—è –æ–±–º–µ–Ω–∞.\n\n„Äê–ò–º–ø–æ—Ä—Ç„Äë\n–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –≤ —ç–∫—Ä–∞–Ω –∏–º–ø–æ—Ä—Ç–∞.\n\n–î–∞–∂–µ –µ—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –µ—Å—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–µ–∫—Å—Ç, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ—á–µ—Ç —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ.\n\n„Äê–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π„Äë\n–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å –∑–∞–º–µ—Ç–æ–∫ ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ Pro-–≤–µ—Ä—Å–∏–∏.",
            de: "√úber Simple Sheet\n\n√úbersichtlicher als ein Taschenrechner,\nEinfacher als eine Tabelle.\n\nSimple Sheet organisiert Berechnungen.\n\nAddieren, Subtrahieren, Multiplizieren, Dividieren.\nDer Weg bleibt erhalten.\n\n„ÄêModuswechsel„Äë\nüè† Basiswert: Verwendet den oberen Wert.\nüîó Kette: Verwendet das vorherige Ergebnis.\n\n„ÄêAlles Kopieren (Tabelle)„Äë\nKopiert das Ergebnis als Tabelle.\n*F√ºgt leere Spalte f√ºr langen Text ein.\n(Ohne JSON-Code)\n\n„ÄêExportieren (Daten)„Äë\nKopiert die Berechnungsdaten.\nZum Teilen in Simple Sheet einf√ºgen.\n\n„ÄêImportieren„Äë\nText in den Import-Bildschirm einf√ºgen.\n\nSelbst wenn Begr√º√üungen oder anderer Text enthalten sind, werden automatisch nur die Daten extrahiert.\n\n„ÄêFunktionseinschr√§nkungen„Äë\nDas Speichern und das Schreiben von Notizen sind Funktionen der Pro-Version."
        };

        const languageMap = {
            en: { title: "Simple Sheet", masterLabelName: "Sheet Name:", masterLabelStart: "üè† Base", rowLabel: "Item Name", copyMsg: "Copied!", btnClear: "Clear", btnExport: "Exp", btnImport: "Imp", btnReset: "Reset", confirmReset: "Reset all?", addRow: "+ Row", copyAll: "üìã Copy All", calcTitle: "Calculator", btnSave: "üíæ Save", btnDone: "Done",
                  manual: "üìñ Manual", btnClose: "Close", msgSave: "Saved!", msgLoad: "Loaded!", confirmDel: "Delete?", msgExported: "Data Code Copied!", msgError: "Error", impTitle:"Import Data", impDesc:"Paste data here:", btnLoad:"Load Data", memoTitle: "üìù MEMO",
                  proTitle: "Get Pro Version üíé", proDesc: "Save, Export, and PC Access are Pro features.\n\nBuy the app to get the URL & Passcode for the Pro Web version!", proBtn: "Go to App Store", btnProLink: "üöÄ How to get Pro?"},
            ja: { title: "Simple Sheet", masterLabelName: "„Ç∑„Éº„ÉàÂêç:", masterLabelStart: "üè† ÂÖÉ„ÅÆÊï∞Â≠ó", rowLabel: "È†ÖÁõÆÂêç", copyMsg: "„Ç≥„Éî„ÉºÂÆå‰∫Ü", btnClear: "„ÇØ„É™„Ç¢", btnExport: "Âá∫Âäõ", btnImport: "Ë™≠Ëæº", btnReset: "ÂàùÊúüÂåñ", confirmReset: "ÂÖ®ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü", addRow: "+ Ë°å„ÇíËøΩÂä†", copyAll: "üìã „Ç™„Éº„É´„Ç≥„Éî„Éº", calcTitle: "ÈõªÂçì", btnSave: "üíæ Ë®òÊÜ∂", btnDone: "ÂÆå‰∫Ü",
                  manual: "üìñ Ë™¨ÊòéÊõ∏", btnClose: "Èñâ„Åò„Çã", msgSave: "‰øùÂ≠ò„Åó„Åæ„Åó„Åü", msgLoad: "Ë™≠„ÅøËæº„Åø„Åæ„Åó„Åü", confirmDel: "ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü", msgExported: "„Éá„Éº„Çø„Ç≥„Éº„Éâ„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü", msgError: "„Ç®„É©„Éº", impTitle:"„Éá„Éº„Çø„ÅÆË™≠Ëæº", impDesc:"„Åì„Åì„Å´„Éá„Éº„Çø„ÇíË≤º„Çä‰ªò„Åë:", btnLoad:"Ë™≠ËæºÈñãÂßã", memoTitle: "üìù „É°„É¢",
                  proTitle: "ProÁâà„ÅÆ„ÅîÊ°àÂÜÖ üíé", proDesc: "‰øùÂ≠ò„ÇÑÂá∫Âäõ„ÄÅPCÁâà„ÅÆÂà©Áî®„ÅØProÁâà„ÅÆÊ©üËÉΩ„Åß„Åô„ÄÇ\n\n„Ç¢„Éó„É™„ÇíË≥ºÂÖ•„Åô„Çã„Å®„ÄÅProÁâàWeb„Çµ„Ç§„Éà„ÅÆURL„Å®„Éë„Çπ„Ç≥„Éº„Éâ„ÅåÊâã„Å´ÂÖ•„Çä„Åæ„ÅôÔºÅ", proBtn: "„Ç¢„Éó„É™„Çπ„Éà„Ç¢„Å∏", btnProLink: "üöÄ ProÁâà„Çí‰Ωø„ÅÜ„Å´„ÅØÔºü"},
            zh: { title: "Simple Sheet", masterLabelName: "Ë°®Ê†ºÂêçÁß∞:", masterLabelStart: "üè† ÂàùÂßãÂÄº", rowLabel: "È°πÁõÆÂêçÁß∞", copyMsg: "Â∑≤Â§çÂà∂", btnClear: "Ê∏ÖÈô§", btnExport: "ÂØºÂá∫", btnImport: "ÂØºÂÖ•", btnReset: "ÈáçÁΩÆ", confirmReset: "Á°ÆËÆ§ÈáçÁΩÆÊâÄÊúâÊï∞ÊçÆÔºü", addRow: "+ Ê∑ªÂä†Ë°å", copyAll: "üìã Â§çÂà∂", calcTitle: "ËÆ°ÁÆóÂô®", btnSave: "üíæ ‰øùÂ≠ò", btnDone: "ÂÆåÊàê",
                  manual: "üìñ ËØ¥Êòé‰π¶", btnClose: "ÂÖ≥Èó≠", msgSave: "Â∑≤‰øùÂ≠ò", msgLoad: "Â∑≤Âä†ËΩΩ", confirmDel: "Âà†Èô§Ôºü", msgExported: "‰ª£Á†ÅÂ∑≤Â§çÂà∂", msgError: "ÈîôËØØ", impTitle:"ÂØºÂÖ•Êï∞ÊçÆ", impDesc:"Á≤òË¥¥‰ª£Á†Å:", btnLoad:"Âä†ËΩΩ", memoTitle: "üìù Â§áÂøòÂΩï",
                  proTitle: "ProÁâàÂäüËÉΩ üíé", proDesc: "Ë¥≠‰π∞Â∫îÁî®‰ª•Ëé∑ÂèñProÁâàURLÂíåÂØÜÁ†Å„ÄÇ", proBtn: "ÂéªÂïÜÂ∫ó", btnProLink: "üöÄ Â¶Ç‰ΩïËé∑ÂèñPro?"},
            ko: { title: "Simple Sheet", masterLabelName: "ÏãúÌä∏ Ïù¥Î¶Ñ:", masterLabelStart: "üè† Í∏∞Ï§ÄÍ∞í", rowLabel: "Ìï≠Î™© Ïù¥Î¶Ñ", copyMsg: "Î≥µÏÇ¨Îê®", btnClear: "ÏßÄÏö∞Í∏∞", btnExport: "ÎÇ¥Î≥¥ÎÇ¥Í∏∞", btnImport: "Í∞ÄÏ†∏Ïò§Í∏∞", btnReset: "Ï¥àÍ∏∞Ìôî", confirmReset: "Ï†ÑÏ≤¥ Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?", addRow: "+ Ìñâ Ï∂îÍ∞Ä", copyAll: "üìã Î≥µÏÇ¨", calcTitle: "Í≥ÑÏÇ∞Í∏∞", btnSave: "üíæ Ï†ÄÏû•", btnDone: "ÏôÑÎ£å",
                  manual: "üìñ ÏÑ§Î™ÖÏÑú", btnClose: "Îã´Í∏∞", msgSave: "Ï†ÄÏû•Îê®", msgLoad: "Î°úÎìúÎê®", confirmDel: "ÏÇ≠Ï†ú?", msgExported: "ÏΩîÎìú Î≥µÏÇ¨Îê®", msgError: "Ïò§Î•ò", impTitle:"Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞", impDesc:"ÏΩîÎìú Î∂ôÏó¨ÎÑ£Í∏∞:", btnLoad:"Î°úÎìú", memoTitle: "üìù Î©îÎ™®",
                  proTitle: "Pro Í∏∞Îä• üíé", proDesc: "Pro Î≤ÑÏ†ÑÏùÑ Íµ¨Îß§ÌïòÏó¨ URLÍ≥º ÏΩîÎìúÎ•º Î∞õÏúºÏÑ∏Ïöî.", proBtn: "Ïä§ÌÜ†Ïñ¥Î°ú Ïù¥Îèô", btnProLink: "üöÄ Pro Î≤ÑÏ†Ñ Î∞õÍ∏∞"},
            es: { title: "Simple Sheet", masterLabelName: "Nombre de hoja:", masterLabelStart: "üè† Valor Base", rowLabel: "Nombre del √≠tem", copyMsg: "¬°Copiado!", btnClear: "Borrar", btnExport: "Exp", btnImport: "Imp", btnReset: "Reiniciar", confirmReset: "¬øReiniciar todo?", addRow: "+ Fila", copyAll: "üìã Copiar", calcTitle: "Calculadora", btnSave: "üíæ Guardar", btnDone: "Listo",
                  manual: "üìñ Manual", btnClose: "Cerrar", msgSave: "¬°Guardado!", msgLoad: "¬°Cargado!", confirmDel: "¬øEliminar?", msgExported: "¬°C√≥digo copiado!", msgError: "Error", impTitle:"Importar", impDesc:"Pegar c√≥digo:", btnLoad:"Cargar", memoTitle: "üìù Nota",
                  proTitle: "Funci√≥n Pro üíé", proDesc: "Compre la app para obtener URL y c√≥digo Pro.", proBtn: "Ir a la tienda", btnProLink: "üöÄ Obtener Pro"},
            pt: { title: "Simple Sheet", masterLabelName: "Nome da Planilha:", masterLabelStart: "üè† Valor Base", rowLabel: "Nome do Item", copyMsg: "Copiado!", btnClear: "Limpar", btnExport: "Exp", btnImport: "Imp", btnReset: "Reset", confirmReset: "Reiniciar tudo?", addRow: "+ Linha", copyAll: "üìã Copiar", calcTitle: "Calculadora", btnSave: "üíæ Salvar", btnDone: "Concluir",
                  manual: "üìñ Manual", btnClose: "Fechar", msgSave: "Salvo", msgLoad: "Carregado", confirmDel: "Excluir?", msgExported: "C√≥digo copiado!", msgError: "Erro", impTitle:"Importar", impDesc:"Cole o c√≥digo:", btnLoad:"Carregar", memoTitle: "üìù Nota",
                  proTitle: "Recurso Pro üíé", proDesc: "Compre o app para obter URL Pro.", proBtn: "Ir para loja", btnProLink: "üöÄ Obter Pro"},
            fr: { title: "Simple Sheet", masterLabelName: "Nom de feuille :", masterLabelStart: "üè† Valeur Base", rowLabel: "Nom de l'√©l√©ment", copyMsg: "Copi√© !", btnClear: "Effacer", btnExport: "Exp", btnImport: "Imp", btnReset: "R√©tablir", confirmReset: "Tout r√©initialiser ?", addRow: "+ Ligne", copyAll: "üìã Copier", calcTitle: "Calculatrice", btnSave: "üíæ Enreg.", btnDone: "OK",
                  manual: "üìñ Manuel", btnClose: "Fermer", msgSave: "Enregistr√©", msgLoad: "Charg√©", confirmDel: "Supprimer ?", msgExported: "Code copi√© !", msgError: "Erreur", impTitle:"Importer", impDesc:"Coller code:", btnLoad:"Charger", memoTitle: "üìù Note",
                  proTitle: "Fonctionnalit√© Pro üíé", proDesc: "Achetez l'app pour obtenir l'URL Pro.", proBtn: "Aller au store", btnProLink: "üöÄ Obtenir Pro"},
            ru: { title: "Simple Sheet", masterLabelName: "–ò–º—è –ª–∏—Å—Ç–∞:", masterLabelStart: "üè† –ë–∞–∑–∞", rowLabel: "–ò–º—è —ç–ª–µ–º–µ–Ω—Ç–∞", copyMsg: "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!", btnClear: "–°–±—Ä–æ—Å", btnExport: "–≠–∫—Å–ø", btnImport: "–ò–º–ø", btnReset: "–°–±—Ä–æ—Å", confirmReset: "–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë?", addRow: "+ –†—è–¥", copyAll: "üìã –ö–æ–ø–∏—è", calcTitle: "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä", btnSave: "üíæ –°–æ—Ö—Ä.", btnDone: "–ì–æ—Ç–æ–≤–æ",
                  manual: "üìñ –ò–Ω—Ñ–æ", btnClose: "–ó–∞–∫—Ä—ã—Ç—å", msgSave: "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!", msgLoad: "–ó–∞–≥—Ä—É–∂–µ–Ω–æ!", confirmDel: "–£–¥–∞–ª–∏—Ç—å?", msgExported: "–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!", msgError: "–û—à–∏–±–∫–∞", impTitle:"–ò–º–ø–æ—Ä—Ç", impDesc:"–í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥:", btnLoad:"–ó–∞–≥—Ä—É–∑–∏—Ç—å", memoTitle: "üìù –ó–∞–º–µ—Ç–∫–∞",
                  proTitle: "Pro –í–µ—Ä—Å–∏—è üíé", proDesc: "–ö—É–ø–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Pro URL.", proBtn: "–í –º–∞–≥–∞–∑–∏–Ω", btnProLink: "üöÄ –ü–æ–ª—É—á–∏—Ç—å Pro"},
            de: { title: "Simple Sheet", masterLabelName: "Blattname:", masterLabelStart: "üè† Basiswert", rowLabel: "Elementname", copyMsg: "Kopiert!", btnClear: "L√∂schen", btnExport: "Exp", btnImport: "Imp", btnReset: "Reset", confirmReset: "Alles zur√ºcksetzen?", addRow: "+ Zeile", copyAll: "üìã Kopieren", calcTitle: "Rechner", btnSave: "üíæ Speichern", btnDone: "Fertig",
                  manual: "üìñ Handbuch", btnClose: "Schlie√üen", msgSave: "Gespeichert!", msgLoad: "Geladen!", confirmDel: "L√∂schen?", msgExported: "Code kopiert!", msgError: "Fehler", impTitle:"Importieren", impDesc:"Code hier einf√ºgen:", btnLoad:"Laden", memoTitle: "üìù Notiz",
                  proTitle: "Pro-Funktion üíé", proDesc: "Kaufen Sie die App f√ºr Pro-Zugang.", proBtn: "Zum Store", btnProLink: "üöÄ Pro holen"}
        };

        let currentLanguage = 'en'; 
        let isEditMode = false;
        let currentCalc = "0";

        function init() {
            const langCont = document.getElementById('langContainer');
            Object.keys(languageMap).forEach(lang => {
                const btn = document.createElement('button');
                btn.style.cssText = "padding:4px 6px; font-size:11px; cursor:pointer; border:1px solid #ccc; border-radius:4px; background:#fff; font-weight:bold; color:#000;";
                btn.textContent = lang.toUpperCase();
                btn.onclick = () => setLanguage(lang);
                langCont.appendChild(btn);
            });

            let saved = localStorage.getItem('simpleSheetLang_final');
            if(!saved) {
                const browserLang = navigator.language.slice(0, 2);
                if(languageMap[browserLang]) saved = browserLang;
                else saved = 'en';
            }
            setLanguage(saved); 
            
            const s = JSON.parse(localStorage.getItem('simpleSheetSettings_final') || '{}');
            applyData(s);
            updateMemoLinks();
        }

        function setLanguage(lang) {
            currentLanguage = lang; 
            localStorage.setItem('simpleSheetLang_final', lang);
            const d = languageMap[lang];
            
            document.getElementById('title').textContent = d.title;
            document.getElementById('labelNameSpan').textContent = d.masterLabelName;
            document.getElementById('masterLabelStart').textContent = d.masterLabelStart;
            document.getElementById('btnClear').textContent = d.btnClear;
            document.getElementById('btnExport').textContent = d.btnExport;
            document.getElementById('btnImport').textContent = d.btnImport;
            document.getElementById('btnReset').textContent = d.btnReset;
            document.getElementById('addBtn').textContent = d.addRow;
            document.getElementById('copyBtn').textContent = d.copyAll;
            document.getElementById('ui-calcTitle').textContent = d.calcTitle;
            document.getElementById('btnSaveMemory').textContent = d.btnSave;
            document.getElementById('modalTitle').textContent = d.proTitle;
            document.getElementById('modalDesc').innerText = d.proDesc;
            document.getElementById('modalBtn').textContent = d.proBtn;
            document.getElementById('btnClosePro').textContent = d.btnClose;
            document.getElementById('btnLinkPro').textContent = d.btnProLink;
            document.getElementById('manTitle').textContent = d.manual;
            document.getElementById('manBody').innerText = fullManual[lang] || fullManual['en'];
            document.getElementById('manClose').textContent = d.btnClose;
            document.getElementById('btnManual').textContent = d.manual;
            document.getElementById('pcModalTitle').textContent = d.pcTitle;
            document.getElementById('pcModalDesc').textContent = d.pcDesc;
            document.getElementById('btnCopyUrl').textContent = d.btnCopy;
            document.getElementById('btnClosePc').textContent = d.btnClose;
            document.getElementById('impTitle').textContent = d.impTitle;
            document.getElementById('impDesc').textContent = d.impDesc;
            document.getElementById('btnDoImport').textContent = d.btnLoad;
            document.getElementById('btnCloseImp').textContent = d.btnClose;
            if(document.getElementById('memoTitle')) document.getElementById('memoTitle').textContent = d.memoTitle;
            
            document.querySelectorAll('.text-label-input').forEach(input => {
                input.placeholder = d.rowLabel;
            });
            updateDisplay();
        }

        function triggerProPromo() { document.getElementById('proModal').classList.add('active'); }
        function closeProModal() { document.getElementById('proModal').classList.remove('active'); }
        function triggerPcModal() { document.getElementById('pcModal').classList.add('active'); }
        function closePcModal() { document.getElementById('pcModal').classList.remove('active'); }
        function copyPcUrl() {
            const urlInput = document.getElementById('pcUrlInput');
            urlInput.select();
            urlInput.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(urlInput.value);
            showMsg(languageMap[currentLanguage].copyMsg);
        }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function openManual() { document.getElementById('manualModal').classList.add('active'); }
        function openImport() { 
            document.getElementById('importText').value = "";
            document.getElementById('importModal').classList.add('active'); 
        }

        function stripError(num) { return parseFloat(num.toPrecision(12)); }
        function formatNum(num) { return stripError(num).toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 3 }); }

        function updateDisplay() {
            const masterValStr = document.getElementById('masterInput').value.replace(/[Ôºê-Ôºô]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0)).replace(/Ôºé/g, '.');
            const mVal = parseFloat(masterValStr) || 0;
            let chain = mVal;
            
            document.querySelectorAll('#rows-container .row').forEach(r => {
                const opEl = r.querySelector('.operator-display');
                const op = opEl ? opEl.textContent.trim() : '+';
                const inputValStr = r.querySelector('.multiplier-input').value.replace(/[Ôºê-Ôºô]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0)).replace(/Ôºé/g, '.');
                const mult = parseFloat(inputValStr) || 0;
                const pct = r.querySelector('.percent-toggle').classList.contains('active');
                const isChain = r.querySelector('.base-toggle').classList.contains('chain');
                const base = isChain ? chain : mVal;
                let mod = pct ? stripError(base * (mult / 100)) : mult;
                let res = 0;
                if(op === '+' || op === 'Ôºã') res = base + mod;
                else if(op === '-' || op === '‚àí' || op === '„Éº') res = base - mod;
                else if(op === '√ó' || op === '*' || op === 'Ôºä' || op === 'x' || op === 'X') res = pct ? stripError(base * (mult / 100)) : stripError(base * mult);
                else if(op === '√∑' || op === '/' || op === 'Ôºè') res = mult !== 0 ? stripError(base / mult) : 0;
                else res = base + mod;
                res = stripError(res);
                r.querySelector('.result-text').textContent = formatNum(res);
                chain = res;
            });
            saveSettings();
        }

        // --- „É°„É¢Â∏≥„ÅÆURL„É™„É≥„ÇØÊ©üËÉΩ ---
        function updateMemoLinks() {
            const text = document.getElementById('memoArea').value;
            const linkDiv = document.getElementById('memoLinks');
            linkDiv.innerHTML = '';
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            const matches = text.match(urlRegex);
            if(matches) {
                matches.forEach(url => {
                    const a = document.createElement('a');
                    a.href = url;
                    a.target = '_blank';
                    a.className = 'memo-link-item';
                    a.textContent = "üåç " + (url.length > 35 ? url.substring(0,32)+"..." : url);
                    linkDiv.appendChild(a);
                });
            }
        }

        function getScreenData() {
            return {
                n: document.getElementById('masterLabel').value, 
                b: document.getElementById('masterInput').value, 
                m: document.getElementById('memoArea').value, 
                r: Array.from(document.querySelectorAll('#rows-container .row')).map(r => ({
                    n: r.querySelector('.text-label-input').value, 
                    p: parseFloat(r.querySelector('.multiplier-input').value) || 0,
                    o: r.querySelector('.operator-display').textContent.trim(), 
                    pct: r.querySelector('.percent-toggle').classList.contains('active'), 
                    c: r.querySelector('.base-toggle').classList.contains('chain') 
                }))
            };
        }

        function applyData(s) {
            if(!s) return;
            document.getElementById('masterLabel').value = s.n || s.name || s.masterLabel || '';
            document.getElementById('masterInput').value = s.b || s.base || s.masterInput || '';
            document.getElementById('memoArea').value = s.m || s.memo || '';
            updateMemoLinks();
            document.getElementById('rows-container').innerHTML = '';
            
            let rowsToLoad = s.r || s.rows || s.simpleRows;
            if(rowsToLoad) { 
                rowsToLoad.forEach(r => {
                    let op = r.o || r.operator || '+';
                    let label = r.n || r.label || '';
                    let val = (r.p !== undefined) ? r.p : (r.multiplier !== undefined ? r.multiplier : '');
                    let isPct = (r.pct !== undefined) ? r.pct : (r.isPercentActive || false);
                    let isChain = (r.c !== undefined) ? r.c : (r.baseMode === 'chain');
                    
                    let rowData = {
                        label: label, multiplier: val, operator: op, isPercentActive: isPct, baseMode: isChain ? 'chain' : 'master'
                    };
                    addRow(rowData);
                }); 
            } else { addRow(); }
            updateDisplay();
        }

        function saveSettings(){ 
            localStorage.setItem('simpleSheetSettings_final', JSON.stringify(getScreenData())); 
        }

        function addRow(s=null) {
            const id = s && s.id ? s.id : Math.random().toString(36).substr(2, 5);
            const ph = languageMap[currentLanguage].rowLabel;
            const div = document.createElement('div'); div.className = 'row'; div.dataset.id = id;
            const isChain = s ? (s.baseMode==='chain') : true; 
            const val = s ? s.multiplier : '';

            div.innerHTML = `
                <input type="text" class="text-label-input" placeholder="${ph}" value="${s?s.label:''}" oninput="saveSettings()">
                <div class="calc-area">
                    <div id="base-${id}" class="base-toggle ${isChain?'chain':''}" onclick="this.classList.toggle('chain');this.textContent=this.classList.contains('chain')?'üîó':'üè†';updateDisplay()">
                        ${isChain?'üîó':'üè†'}
                    </div>
                    <div class="operator-group">
                        <div class="operator-control" onclick="changeOp('${id}',1)">‚ñ≤</div>
                        <div class="operator-display" id="op-${id}">${s?s.operator:'+'}</div>
                        <div class="operator-control" onclick="changeOp('${id}',-1)">‚ñº</div>
                    </div>
                    <input type="number" step="any" class="multiplier-input" value="${val}" placeholder="" oninput="updateDisplay()">
                    <div class="percent-toggle ${s&&s.isPercentActive?'active':''}" onclick="this.classList.toggle('active');updateDisplay()">%</div>
                </div>
                <div class="result-area">
                    <div class="result-text">0</div>
                    <div style="display:flex; gap:10px;">
                        <button class="action-btn" onclick="copyRowVal(this)">üìã</button>
                        <button class="action-btn" onclick="this.closest('.row').remove();updateDisplay()">üóëÔ∏è</button>
                    </div>
                </div>
            `;
            document.getElementById('rows-container').appendChild(div); 
            updateDisplay();
        }

        function changeOp(id, d) { 
            const ops = ['+','-','√ó','√∑']; 
            const el = document.getElementById('op-'+id).closest('.row').querySelector('.operator-display');
            const currentOp = el.textContent.trim();
            el.textContent = ops[(ops.indexOf(currentOp) + d + 4) % 4]; 
            updateDisplay(); 
        }

        function copyRowVal(btn) { 
            navigator.clipboard.writeText(btn.closest('.result-area').querySelector('.result-text').textContent.replace(/,/g,'')); 
            showMsg(languageMap[currentLanguage].copyMsg); 
        }

        function escapeForExcel(text) {
            if (!text) return "";
            let str = String(text);
            str = str.replace(/\t/g, ' '); 
            str = str.replace(/"/g, '""'); 
            if (str.search(/[\n\r"]/) >= 0) {
                str = `"${str}"`; 
            }
            return str;
        }

        function escapeHtml(str) {
            if(!str) return "";
            return str.replace(/[&<>"']/g, function(m) {
                return {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                }[m];
            });
        }

        function insertAutoBreaks(text) {
            let res = "";
            const lines = text.split('\n');
            lines.forEach((line, idx) => {
                if(line.length > 40) {
                    for(let i=0; i<line.length; i+=40) {
                        res += escapeHtml(line.substr(i, 40)) + "<br>";
                    }
                } else {
                    res += escapeHtml(line) + "<br>";
                }
            });
            return res;
        }

        // --- Copy Logic (HTML + Text) ---
        async function copyPage() { 
            const title = document.getElementById('masterLabel').value || 'Sheet';
            const baseLabel = languageMap[currentLanguage].masterLabelStart;
            const baseVal = document.getElementById('masterInput').value;
            
            // Text Format
            let t = `„Äê${escapeForExcel(title)}„Äë\n`;
            t += `${baseLabel}\t\t${baseVal}\n`;
            
            // HTML Format
            let h = `<table>`;
            // „Çø„Ç§„Éà„É´: ‰∏≠Â§ÆÂØÑ„Åõ„ÉªËÉåÊôØ„Ç∞„É¨„Éº„ÉªÂ§™Â≠ó„Å™„Åó
            h += `<tr><td colspan="3" style="background-color:#EFEFEF; text-align:center; font-size:14pt;">„Äê${escapeHtml(title)}„Äë</td></tr>`;
            h += `<tr><td>${escapeHtml(baseLabel)}</td><td></td><td>${escapeHtml(baseVal)}</td></tr>`;

            document.querySelectorAll('#rows-container .row').forEach(r => { 
                const label = r.querySelector('.text-label-input').value || '-';
                const val = r.querySelector('.result-text').textContent.replace(/,/g, '');
                
                t += `${escapeForExcel(label)}\t\t${val}\n`; 
                h += `<tr><td>${escapeHtml(label)}</td><td></td><td>${escapeHtml(val)}</td></tr>`;
            });
            
            const memo = document.getElementById('memoArea').value;
            if(memo) {
                t += `\n[Memo]\n${escapeForExcel(memo)}`;
                // „É°„É¢: ËñÑ„ÅÑÈªÑËâ≤ËÉåÊôØ„ÉªËá™ÂãïÊîπË°åÊåøÂÖ•„ÉªÊäò„ÇäËøî„Åó„Çπ„Çø„Ç§„É´
                const htmlMemo = insertAutoBreaks(memo);
                h += `<tr><td colspan="3" style="background-color:#FFF2CC; vertical-align:top; white-space:normal; word-wrap:break-word;"><b>[ Memo ]</b><br>${htmlMemo}</td></tr>`;

                const urlRegex = /(https?:\/\/[^\s]+)/g;
                const matches = memo.match(urlRegex);
                if(matches) {
                    t += "\n[Links]\n";
                    h += `<tr><td colspan="3" style="background-color:#EFEFEF; font-weight:bold;">[ Links ]</td></tr>`;
                    matches.forEach(url => {
                        t += `${url}\n`;
                        h += `<tr><td colspan="3"><a href="${url}" target="_blank">${url}</a></td></tr>`;
                    });
                }
            }
            h += `</table>`;

            try {
                const blobText = new Blob([t], { type: 'text/plain' });
                const blobHtml = new Blob([h], { type: 'text/html' });
                const item = new ClipboardItem({ 
                    'text/plain': blobText, 
                    'text/html': blobHtml 
                });
                await navigator.clipboard.write([item]);
                showMsg(languageMap[currentLanguage].copyMsg);
            } catch (err) {
                // Fallback
                navigator.clipboard.writeText(t);
                showMsg(languageMap[currentLanguage].copyMsg + " (Text)");
            }
        }

        function exportData() { 
            const data = JSON.stringify(getScreenData());
            let output = "";
            const title = data.n || "Simple Sheet";
            output += `„Äê ${title} „Äë\n\n`;
            
            const memo = data.m || "";
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            const matches = memo.match(urlRegex);
            if(matches && matches.length > 0) {
                output += "[Links]\n";
                matches.forEach(url => { output += `${url}\n`; });
                output += "\n";
            }
            
            output += "‚ñº DATA CODE ‚ñº\n";
            output += data;
            navigator.clipboard.writeText(output); 
            showMsg(languageMap[currentLanguage].msgExported); 
        }

        // --- Import (Ëá™ÂãïÊäΩÂá∫) ---
        function executeImport() {
            let text = document.getElementById('importText').value.trim();
            if(!text) return;
            
            text = text.replace(/```json/g, "").replace(/```/g, "").trim();

            const firstBrace = text.indexOf('{');
            const lastBrace = text.lastIndexOf('}');
            if (firstBrace !== -1 && lastBrace !== -1 && firstBrace < lastBrace) {
                try {
                    const potentialJson = text.substring(firstBrace, lastBrace + 1);
                    const j = JSON.parse(potentialJson);
                    applyData(j);
                    showMsg(languageMap[currentLanguage].msgLoad);
                    closeModal('importModal');
                    return;
                } catch(e) {}
            }

            // „ÉÜ„Ç≠„Çπ„ÉàËß£Êûê
            if(tryParseText(text)){ 
                showMsg(languageMap[currentLanguage].msgLoad);
                closeModal('importModal');
            } else {
                showMsg(languageMap[currentLanguage].msgError);
            }
        }

        function tryParseText(text) {
             const lines = text.trim().split(/\r?\n/);
            if (lines.length < 1) return false;
            let name = ""; let base = 0; let rows = []; let startRowIdx = 0;
            const titleMatch = lines[0].match(/„Äê(.*?)„Äë/);
            if (titleMatch) { name = titleMatch[1]; startRowIdx = 1; } 
            else if (!isNaN(parseFloat(lines[0])) && lines[0].trim().match(/^[\d\.-]+$/)) { base = parseFloat(lines[0]); startRowIdx = 1; } 
            
            if (startRowIdx < lines.length) {
                const rowText = lines[startRowIdx];
                const baseValMatch = rowText.match(/[\d\.-]+/);
                if (rowText.includes("Base") || rowText.includes("ÂÖÉ") || (!rowText.includes("\t") && baseValMatch)) {
                    if (baseValMatch) base = parseFloat(baseValMatch[0]);
                    startRowIdx++;
                }
            }

            let readingMemo = false;
            let memoContent = "";

            for (let i = startRowIdx; i < lines.length; i++) {
                const line = lines[i].trim(); if (!line) continue;
                if (line.includes("[Memo]") || line.includes("‚ñº DATA CODE")) { readingMemo = true; continue; }
                if (readingMemo) { 
                    if(line.includes("‚ñº DATA CODE")) break; 
                    if (!line.startsWith("Link\t")) {
                        memoContent += line + "\n"; 
                    }
                    continue; 
                }

                let parts = line.split(/\t+/); if (parts.length < 2) parts = line.split(/\s{2,}/);
                
                if (parts.length >= 2) {
                    let valStr = parts[parts.length-1].replace(/,/g, '');
                    if (!isNaN(parseFloat(valStr))) {
                        const val = parseFloat(valStr);
                        const label = parts.slice(0, parts.length-1).join(" ").trim();
                        rows.push({ label: label, multiplier: val, operator: '+', baseMode: 'chain', isPercentActive: false });
                    }
                }
            }
            
            if (rows.length === 0 && base === 0 && !name) return false;
            document.getElementById('masterLabel').value = name; 
            document.getElementById('masterInput').value = base;
            document.getElementById('memoArea').value = memoContent.trim();
            updateMemoLinks();
            document.getElementById('rows-container').innerHTML = "";
            rows.forEach(r => addRow(r)); updateDisplay();
            return true;
        }

        function calcInput(v) { 
            if(v === 'AC') { currentCalc = "0"; }
            else if(v === 'BS') { currentCalc = currentCalc.length > 1 ? currentCalc.slice(0, -1) : "0"; }
            else {
                if(currentCalc === "0" && v !== ".") currentCalc = v; 
                else currentCalc += v; 
            }
            document.getElementById('calcDisplay').value = currentCalc; 
        }
        
        function calcResult() { 
            try { 
                let expression = currentCalc.replace(/√ó/g, '*').replace(/√∑/g, '/').replace(/%/g, '/100');
                let res = eval(expression); 
                currentCalc = stripError(res).toString();
            } catch(e) { 
                currentCalc = "Error"; 
            } 
            document.getElementById('calcDisplay').value = currentCalc; 
        }
        function copyCalcResult() { 
            navigator.clipboard.writeText(document.getElementById('calcDisplay').value); 
            showMsg(languageMap[currentLanguage].copyMsg); 
        }
        function toggleCalc() { 
            document.getElementById('sideCalc').classList.toggle('active'); 
        }

        function clearNumbers() { 
            document.getElementById('masterInput').value = ""; 
            document.getElementById('memoArea').value = ""; 
            document.querySelectorAll('.multiplier-input').forEach(i => i.value = ""); 
            updateMemoLinks();
            updateDisplay(); 
        }
        function fullReset() { 
            if(confirm(languageMap[currentLanguage].confirmReset)) { 
                localStorage.removeItem('simpleSheetSettings_final'); 
                location.reload(); 
            } 
        }
        function showMsg(t) { 
            const m = document.getElementById('saveMessage'); 
            m.textContent = t; 
            m.style.opacity = 1; 
            setTimeout(() => m.style.opacity = 0, 1500); 
        }

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').catch(err => console.log('SW failed', err));
            });
        }
    </script>
</body>
</html>
